<?php
session_start();
require_once('../CONEXION/CONEXION.PHP');
?>

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="estilos_login.css">
    <script src="https://kit.fontawesome.com/9df778104c.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
    <title>Recuperar Contraseña</title>
</head>
<body>
<div class="contenedor-recuperar">
    <div class="form-container">
        <div class="d-flex justify-content-start volverweb">
            <a class="salirlogin" href="index.html"><i class="fa-solid fa-chevron-left"></i>&nbsp;Volver</a>
        </div>

        <form action="" method="post">
            <h3>Actualizar Contraseña</h3><br>
            Correo electrónico:
            <input class="form-control" type="email" name="txtemail" required><br>
            Ingresa nueva Contraseña:
            <input class="form-control" type="password" name="txtwp" required><br>
            <div class="form-group text-center">
                <input class="btn btn-primary" type="submit" name="actualizar" value="Confirmar">
            </div>
        </form>

        <?php
        if (isset($_POST['actualizar'])) {
            // Limpiar y validar los datos del formulario
            $email = mysqli_real_escape_string($conexion, $_POST['txtemail']);
            $contrasena = mysqli_real_escape_string($conexion, $_POST['txtwp']);
            
            // Verificar si el correo existe en la base de datos
            $sql = "SELECT * FROM USUARIO WHERE CORREO = '$email'";
            $resultado = mysqli_query($conexion, $sql);
            
            if (mysqli_num_rows($resultado) > 0) {
                // Encriptar la nueva contraseña
                $hashed_contrasena = password_hash($contrasena, PASSWORD_BCRYPT);
                
                // Actualizar la contraseña en la base de datos
                $update_sql = "UPDATE USUARIO SET CONTRASENA = '$hashed_contrasena' WHERE CORREO = '$email'";
                if (mysqli_query($conexion, $update_sql)) {
                    echo "<script>alert('Contraseña Actualizada');</script>";
                    echo "<script>window.open('LOGIN.PHP', '_self');</script>";
                } else {
                    echo "<script>alert('Error al actualizar la contraseña');</script>";
                }
            } else {
                echo "<script>alert('Correo no encontrado');</script>";
            }
        }
        ?>

    </div>
</div>
<footer class="pie-pagina">
    <div class="grupo-1">
        <div class="box">
            <figure>
                <a href="#" aria-label="Los Potrillos Home">
                    <img 
                        src="logoprueba-removebg-preview.png" 
                        alt="Los Potrillos Veterinary Services Logo" 
                    >
                </a>
            </figure>
        </div>
        <div class="box">
            <h2>Sobre Nosotros</h2>
            <p>Fundado y dirigido por Fredy Alexy López Cortes, un profesional destacado en Medicina Veterinaria y Zootecnia.</p>
            <p>Con formación académica de la UPTC Colombia y UNACH México, nos dedicamos a brindar servicios veterinarios de alta calidad.</p>
            <nav>
                <a href="SOBRE.html">Conoce Más</a>
                <a href="SERVICIOS.html">Nuestros Servicios</a>
            </nav>
        </div>
        <div class="box">
            <h2>Síguenos</h2>
            <div class="red-social">
                <a 
                    href="https://www.facebook.com/MgMvzFredyLopez" 
                    class="fa-brands fa-facebook" 
                    aria-label="Visita nuestro Facebook"
                    rel="noopener noreferrer"
                ></a>
                <a 
                    href="https://www.instagram.com/potrillos_vet" 
                    class="fa-brands fa-instagram" 
                    aria-label="Síguenos en Instagram"
                    rel="noopener noreferrer"
                ></a>
                <a 
                    href="#" 
                    class="fa-brands fa-tiktok" 
                    aria-label="Síguenos en TikTok"
                    rel="noopener noreferrer"
                ></a>
            </div>
        </div>
    </div>
    <div class="grupo-2">
        <small>
            &copy;2024 <b>Los Potrillos</b> - Todos los derechos reservados
            <br>
            <b>Desarrollado por: Daniel Rojas</b>
        </small>
    </div>
</footer>


</body>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</html>
</html>
